# BirthKeeper 第6周性能回归记录

## 1. 回归信息
- 回归日期：2026-02-13
- 项目路径：`D:\MobileApps\BirthKeeper`
- 应用包名：`com.zhongxul.birthkeeper`
- 应用版本：`0.1.0 (versionCode=1)`
- 测试设备：`V2171A`
- 系统版本：`Android 15 (SDK 35)`
- 构建类型：`debug` + `release`

## 2. 采集方法
先注入环境：

```powershell
. "D:\Video Downloader\环境一键配置.ps1"
```

执行冷启动采样（20 次）：

```powershell
.\scripts\startup-benchmark.ps1 -Runs 20 -OutputCsv .\docs\startup-benchmark-2026-02-13.csv
```

执行 `release` 口径采样（20 次）：

```powershell
.\gradlew.bat :app:installRelease
.\scripts\startup-benchmark.ps1 -Runs 20 -OutputCsv .\docs\startup-benchmark-2026-02-13-release.csv
```

采样策略：
- 每轮先 `force-stop` 应用，再执行 `am start -W`。
- 仅统计 `LaunchState=COLD` 的样本（本次 20/20 均为 COLD）。
- 统计字段使用 `TotalTime`、`WaitTime`（Android 15 输出未包含 `ThisTime`）。

## 3. 结果汇总

### 3.0 debug（20 次）

### 3.1 TotalTime（ms）
- 样本数：20
- 平均值：1477.8
- P95：1605
- 最小值：1305
- 最大值：1647

### 3.2 WaitTime（ms）
- 样本数：20
- 平均值：1484.5
- P95：1615
- 最小值：1309
- 最大值：1654

原始样本文件：
- `docs/startup-benchmark-2026-02-13.csv`

### 3.3 release（20 次）

#### TotalTime（ms）
- 样本数：20
- 平均值：453.6
- P95：535
- 最小值：359
- 最大值：575

#### WaitTime（ms）
- 样本数：20
- 平均值：465.2
- P95：549
- 最小值：376
- 最大值：614

原始样本文件：
- `docs/startup-benchmark-2026-02-13-release.csv`

## 4. 目标对比与结论
- 目标：冷启动 `< 1.5s`（中端机）。
- 结论：
  - `debug` 口径：平均值接近目标，但 `P95=1605ms`，不作为发布验收口径。
  - `release` 口径：`P95=535ms`，稳定满足 `<1.5s`。
  - 当前判断：发布口径性能目标已达成。

## 5. 风险点
- 首次安装后可能出现通知权限页面，若不预授权会污染冷启动结果。
- `debug` 口径受调试开销、设备状态影响明显，波动大于 `release`。
- 当前为单机型基线，尚未覆盖更多中端机型。

## 6. 回滚与处置方案
- 本次仅新增采集脚本与回归文档，不涉及业务逻辑与数据库结构变更，无运行时回滚风险。
- 若后续性能优化引入回归，按模块粒度回退最近优化提交，并重新执行本记录中的采集脚本进行对比验证。

## 7. 当前状态标记
- 功能状态：核心功能初步实现，已进入发布前收口阶段。
- 性能状态：`release` 口径已达标，`debug` 口径保留作开发趋势参考。
- 下次回归建议时间：每次发布候选构建（RC）产出当日，至少复测 20 次 `release` 冷启动。

## 8. 说明
- 为便于本机安装 `release` 包进行性能回归，已在 `app/build.gradle.kts` 中将 `release` 签名配置为本地 `debug` 签名。
- 该配置仅用于本地性能测试，不代表商店发布签名策略。
