# 生日记录与提醒安卓 App 初步设计方案（纯离线版）

## 1. 产品目标
打造一款“**录入快、提醒准、隐私强**”的生日管理工具，且**仅在本机离线运行**，支持：
- 手动录入生日信息；
- 输入身份证号自动解析出生日期（可附带校验）；
- 上传/拍摄身份证图片自动识别并提取信息；
- 在生日临近时通过本地通知提醒用户。

> 约束前提：当前版本不做云端、账号、联网接口与在线同步设计。

---

## 1.1 进度同步（截至 2026-02-13）
- 本文档中的 V0.1/V0.2 核心目标已基本落地到工程实现。
- 已落地：
  - 手动录入、联系人管理、身份证号解析与脱敏
  - 身份证图片离线 OCR 识别与失败手动兜底
  - 本地提醒（WorkManager + AlarmManager）与通知跳转
  - 本地备份恢复与敏感信息加密存储
- 尚在收口：
  - 冷启动稳定性（`debug` 口径 `P95=1605ms`，`release` 口径 `P95=535ms`，发布口径已达标）
  - 少量端到端自动化场景继续补齐
- 已新增回归记录：`docs/第6周-性能回归记录.md`

---

## 2. 核心用户场景
1. **家庭用户**：记录家人（父母、孩子、伴侣）生日，提前一周提醒准备礼物。
2. **社交用户**：记录朋友、同学生日，在当天和前一天提醒。
3. **工作用户（个人设备）**：记录合作伙伴生日，并添加备注（喜好、禁忌），仅自己在本机查看。

---

## 3. 功能设计（MVP 到增强版）

## 3.1 MVP（建议第一阶段）
### A. 人员信息管理
- 新增/编辑/删除生日对象；
- 字段：姓名、生日、公历/农历、关系、备注、头像（可选）；
- 支持分组：家人、朋友、同事、自定义标签。

### B. 身份证号录入与自动解析
- 输入身份证号后自动提取：
  - 出生日期；
  - 性别（奇偶位推断）；
  - 年龄（动态计算）；
- 提供**身份证号格式校验**与校验位检查（提示用户确认，不做强制）。

### C. 身份证图片识别（拍摄/上传）
- 支持相机拍摄或相册上传；
- OCR 识别姓名、身份证号；
- 自动回填到表单，用户一键确认保存；
- 识别失败时可手动纠正。

### D. 提醒系统（本地）
- 提醒时间可设：当天/提前1天/提前3天/提前7天；
- 通知栏提醒 + App 内提醒列表；
- 支持一键“已准备”标记，避免重复焦虑提醒。

### E. 首页与日历视图
- 首页展示“最近 30 天生日清单”；
- 月历标记生日日期，点击可查看对象详情。

## 3.2 增强功能（第二阶段）
- 农历生日自动换算并每年更新；
- 本地数据备份/恢复（仅导出到本机文件）；
- 本地祝福模板管理（复制文本到剪贴板）；
- 智能礼物建议（按关系、年龄、预算）。

## 3.3 高级功能（第三阶段）
- 语音录入（“帮我记下妈妈生日是...”）；
- 智能提醒策略（基于本地历史操作自动调整提前天数）；
- 桌面小组件（倒计时/最近生日）。

---

## 4. 关键流程设计

## 4.1 快速录入流程（身份证号）
1. 点击“新增”；
2. 输入姓名（可后填）+ 身份证号；
3. 系统自动解析出生日期/性别/年龄；
4. 用户确认提醒规则；
5. 保存成功。

## 4.2 OCR 录入流程（拍照/上传）
1. 点击“拍身份证”或“上传身份证”；
2. 图片预处理（裁剪、拉正、去反光提示）；
3. OCR 输出姓名 + 身份证号；
4. 自动解析生日并回填；
5. 用户确认后保存。

## 4.3 提醒触达流程（离线）
1. 定时任务每日检查未来 N 天生日；
2. 生成本地通知；
3. 用户点击通知进入“对象详情”；
4. 可直接执行“设为已处理 / 复制祝福语”。

---

## 5. 技术方案建议（Android 离线实现）

## 5.1 客户端技术栈
- 语言：Kotlin；
- UI：Jetpack Compose（效率高，便于快速迭代）；
- 架构：MVVM + Repository；
- 本地存储：Room（离线可用）；
- 定时提醒：WorkManager + AlarmManager（机型兼容）；
- 图片采集：CameraX；
- OCR：ML Kit 本地文本识别（离线模型）。

## 5.2 身份证解析与本地 OCR
- 仅使用本地 OCR，不调用云端识别接口；
- 识别后做字段校验：
  - 身份证号位数/校验码；
  - 出生日期合法性（如闰年）；
  - 异常值提示用户确认。

## 5.3 本地备份恢复（可选）
- 导出：将联系人与提醒配置导出为本地加密文件；
- 导入：用户手动选择文件恢复；
- 不做自动上传、跨设备同步、在线冲突合并。

---

## 6. 数据结构建议（简版）

### Person（生日对象）
- id
- name
- idNumber（建议加密存储）
- birthdaySolar
- birthdayLunar（可空）
- gender
- relation
- note
- avatarUri
- reminderConfig
- createdAt / updatedAt

### ReminderConfig
- remindOffsets（如 [7,3,1,0]）
- remindTime（如 09:00）
- notificationEnabled

### OCRRecord（可选）
- sourceType（camera/gallery）
- imageUri（建议短期缓存后删除）
- extractedName
- extractedIdNumber
- confidence

---

## 7. 隐私与合规（重点）
由于涉及身份证信息，建议从第一版就严格设计：
- 默认**仅本地存储**；
- 身份证号展示脱敏（如 110*********1234）；
- 敏感字段加密存储（如 Android Keystore + SQLCipher）；
- 明确权限说明：相机、相册权限用途透明；
- 提供“一键清空敏感数据”；
- OCR 原图默认不长期保存；
- 允许用户仅保存生日，不保存身份证号。

> 建议在产品文案中强调“生日提醒工具，不做身份核验用途”，降低误解与风险。

---

## 8. 我给你的产品增强建议（离线可落地）
1. **重要度机制**：每个联系人设置“普通/重要/VIP”，提醒策略自动差异化。
2. **礼物与祝福计划卡片**：在提醒页显示“去年送了什么、今年预算多少”。
3. **防打扰策略**：工作日上班前提醒、节假日延后提醒。
4. **生日倒计时桌面小组件**：增强高频触达。
5. **智能输入助手**：识别后自动推荐关系（如“妈妈/同事”）和默认提醒模板。

---

## 9. 版本路线图（建议）
- **V0.1（4~6 周）**：手动录入 + 身份证号解析 + 基础提醒 + 本地存储。
- **V0.2（3~4 周）**：身份证 OCR 识别 + 日历视图 + 脱敏显示。
- **V0.3（4~6 周）**：农历支持 + 本地备份/恢复 + 小组件。
- **V1.0（4~6 周）**：语音录入 + 智能提醒策略 + 本地体验优化。

---

## 10. 成功指标（可量化）
- 新用户 3 分钟内完成首次录入率 > 80%；
- OCR 一次识别成功率 > 90%（清晰图片）；
- 生日提醒到达率 > 95%；
- 关键数据本地恢复成功率 > 99%。

---

## 11. 一句话总结
聚焦“**纯离线、快速录入、稳定提醒、隐私优先**”，先把本机体验做深做稳，再考虑是否有必要扩展联网能力。
