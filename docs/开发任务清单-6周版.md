# BirthKeeper 开发任务清单（6 周可执行版）

## 1. 目标与范围
- 目标版本：`V0.1 + V0.2 核心能力`
- 交付重点：离线生日管理、身份证号解析、OCR 回填、本地提醒、基础隐私与测试闭环
- 明确不做：云端账号、在线 OCR、联网同步

## 2. 任务拆分规则
- 每个任务都要有：负责人、预计工时、完成定义（DoD）、测试记录
- 提交粒度：一个功能点一个 PR，禁止超大混合 PR
- 数据库变更必须包含：Migration + 对应测试
- 涉及身份证信息的功能必须包含：脱敏展示 + 加密存储校验

## 3. 模块清单
- `app`：应用入口、导航、依赖注入
- `feature-person`：联系人列表、详情、新增编辑
- `feature-capture`：拍照/上传、OCR、回填
- `feature-reminder`：提醒配置、提醒中心
- `core-domain`：实体、UseCase、校验器
- `core-data`：Room、DAO、Repository、迁移
- `core-common`：日期工具、脱敏工具、加解密工具、日志规范

## 4. 周计划（可直接排期）

## 第 1 周：项目骨架与数据底座
- 建立多模块工程结构与依赖关系
- 完成导航框架与基础主题
- 设计并落地 Room `person`、`reminder_config`、`reminder_log` 三表
- 建立 Repository 接口与基础实现骨架
- 输出首版数据库 ER 图与 schema 导出
- 完成基础 CI（编译 + 单元测试）

验收标准：
- 能编译运行到首页空状态
- 数据库可创建并通过基础 CRUD 验证
- CI 可在每次提交自动执行

## 第 2 周：联系人管理与身份证号解析
- 完成联系人列表页（搜索、分组、空态）
- 完成新增/编辑联系人页（手动录入流程）
- 实现身份证号解析 UseCase（格式、校验位、生日、性别、年龄）
- 实现身份证号脱敏展示（列表/详情）
- 完成 `feature-person` 到 `core-data` 的写入闭环

验收标准：
- 新增、编辑、删除、查询完整可用
- 身份证号合法与非法样例解析结果正确
- UI 默认脱敏，编辑态可临时查看明文

## 第 3 周：OCR 录入链路
- 集成 CameraX 拍照与相册选图
- 集成 ML Kit 离线文本识别
- 实现姓名/身份证号正则提取与候选处理
- 完成 OCR 结果回填到新增/编辑表单
- 实现 OCR 失败兜底（提示 + 手动修正）
- 增加 OCR 临时图片清理策略

验收标准：
- 清晰样本可完成拍照识别并回填
- 识别失败不阻塞手动录入
- 临时图片在成功后自动清理

## 第 4 周：本地提醒系统
- 完成提醒配置页（提前天数、提醒时间、开关）
- 接入 WorkManager 每日扫描任务
- 接入 AlarmManager 当天精确触发补偿
- 完成通知创建、点击跳转详情页
- 完成提醒中心（待处理/已处理）页面与状态流

验收标准：
- `offset=[7,3,1,0]` 可按配置触发通知
- 点击通知可正确进入对应联系人详情
- 提醒状态可从待处理切换为已处理

## 第 5 周：隐私安全与备份恢复
- 落地身份证号 AES-GCM 加密存储
- 对接 Android Keystore 密钥管理
- 完成日志脱敏规范与拦截工具
- 实现本地导出（`person + reminder_config`）与文件级加密
- 实现本地导入（覆盖/合并）与冲突处理
- 导入流程加事务回滚

验收标准：
- 数据库中无身份证号明文
- 导入失败可完全回滚且有错误提示
- 导出文件可在新安装实例成功恢复

## 第 6 周：测试补齐与发布准备
- 补齐单元测试：身份证解析、年龄计算、提醒生成、脱敏/加解密
- 补齐集成测试：Room Migration、提醒调度、备份导入导出
- 补齐 UI 测试：新增联系人全流程、OCR 失败兜底、通知跳转
- 进行性能优化（冷启动、列表滚动、OCR 耗时）
- 完成隐私自检清单与发布包检查

验收标准：
- 核心测试通过率 100%
- 冷启动达到文档目标（中端机 < 1.5s）
- 可输出候选发布包（RC）并完成回归记录

## 4.1 执行状态同步（截至 2026-02-13）

### 已完成
- 第 1 周：完成
- 第 2 周：完成
- 第 3 周：完成
- 第 4 周：完成
- 第 5 周：完成
- 第 6 周（测试补齐）：
  - 单元测试已补齐并通过（`core-domain`、`core-common`、`core-data`、`app`、`feature-*`）
  - 关键 UI 自动化已补齐并通过（新增联系人、通知跳转、OCR 兜底回填、提醒状态流转）
  - 已输出性能回归文档：`docs/第6周-性能回归记录.md`
  - 已输出隐私与发布检查清单：`docs/发布前隐私与发布检查清单.md`

### 进行中
- 第 6 周（性能优化）：
  - `debug` 基线（20 次）：`TotalTime` 平均 `1477.8ms`、`P95 1605ms`（开发参考）
  - `release` 基线（20 次）：`TotalTime` 平均 `453.6ms`、`P95 535ms`（发布口径达标）

### 待完成
- 提醒链路更深的端到端自动化（如跨天重调度、闰年边界）
- 多机型 `release` 性能回归（至少再补 1 台中端机）

## 5. 测试样本清单（建议最小集）
- 身份证号：合法 10 组、非法 20 组（含校验位错、日期错、长度错）
- OCR 图片：清晰 30 张、反光 20 张、遮挡 20 张
- 提醒样本：跨月、闰年、当天生日、提前多档配置
- 备份恢复：空数据、重复数据、大数据量（1k 联系人）

## 6. 每周评审输出
- 本周完成项与未完成项
- 风险清单与阻塞项
- 下周任务调整
- 关键指标：新增录入成功率、OCR 成功率、提醒触达成功率、恢复成功率

## 7. 建议的 Issue 模板字段
- `模块`：app / person / capture / reminder / core
- `类型`：feature / bug / test / refactor / chore
- `需求描述`
- `技术方案`
- `验收标准`
- `测试点`
- `风险与回滚方案`
